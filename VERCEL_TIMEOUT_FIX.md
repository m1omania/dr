# Исправление ошибок 500/502 на Vercel

## Проблема
Vercel возвращает ошибки 500 и 502 при запросах к backend.

## Причины

### 1. Таймаут Vercel
Vercel имеет ограничения на время выполнения API routes:
- **Hobby (Free):** 10 секунд
- **Pro:** 60 секунд
- **Enterprise:** 300 секунд

Анализ сайта может занимать больше 10 секунд, особенно если:
- Сайт медленно загружается
- Нужно сделать скриншот
- AI API отвечает медленно

### 2. Неправильный API_URL
Если `API_URL` на Vercel указан с `:4001`, это может вызывать проблемы, так как перенаправление портов настроено в панели Jino.ru.

**Правильно:** `http://53893873b619.vps.myjino.ru` (без `:4001`)

### 3. Backend отвечает слишком долго
Backend может обрабатывать запрос дольше, чем позволяет таймаут Vercel.

## Решения

### Решение 1: Проверить API_URL на Vercel

1. Откройте Vercel Dashboard
2. Settings → Environment Variables
3. Проверьте `API_URL`:
   - Должно быть: `http://53893873b619.vps.myjino.ru` (без `:4001`)
   - Если указано с `:4001`, удалите `:4001`

### Решение 2: Использовать Vercel Pro план

Если у вас Free план, рассмотрите upgrade на Pro для увеличения таймаута до 60 секунд.

### Решение 3: Оптимизировать backend

Ускорить обработку запросов на backend:
- Использовать `USE_SINGLE_PROCESS=true` для снижения нагрузки
- Оптимизировать Puppeteer
- Кешировать результаты

### Решение 4: Использовать асинхронный подход

Вместо синхронного запроса использовать:
1. Frontend отправляет запрос
2. Backend обрабатывает асинхронно
3. Frontend периодически проверяет статус

Но это требует изменений в архитектуре.

## Проверка

### 1. Проверить API_URL на Vercel
```bash
# В Vercel Dashboard
Settings → Environment Variables → API_URL
# Должно быть: http://53893873b619.vps.myjino.ru
```

### 2. Проверить логи Vercel
В Vercel Dashboard:
- Deployments → ваш деплой → Functions → api/audit → Logs

Ищите:
- Таймауты
- Ошибки подключения
- Детали ошибок

### 3. Проверить доступность backend
```bash
curl http://53893873b619.vps.myjino.ru/health
```

## Текущий статус

- ✅ Backend работает (тестовый запрос успешен)
- ❌ Vercel получает ошибки 500/502
- ⏳ Нужно проверить API_URL на Vercel
- ⏳ Возможно, проблема с таймаутом Vercel (10 секунд на Free плане)

## Рекомендации

1. **Проверьте API_URL на Vercel** - должно быть без `:4001`
2. **Проверьте логи Vercel** для деталей ошибки
3. **Рассмотрите upgrade на Pro** если таймаут 10 секунд недостаточен
4. **Оптимизируйте backend** для ускорения обработки

